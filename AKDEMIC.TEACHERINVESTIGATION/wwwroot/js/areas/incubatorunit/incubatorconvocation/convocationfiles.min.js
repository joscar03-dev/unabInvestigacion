var InitApp=function(){var t=$("#IncubatorConvocationId").val(),e={files:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:`/unidad-emprendimiento/convocatorias-emprendimiento/${t}/archivos`.proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){delete t.columns,t.handler="Datatable",t.searchValue=$("#search").val()}},pageLength:50,orderable:[],columns:[{title:"Número",data:"number"},{title:"Nombre",data:"name"},{title:"Archivo",data:null,orderable:!1,render:function(t){var e="";return e+=`<a href="${`/documentos/${t.filePath}`.proto().parseURL()}"  `,e+="class='btn btn-success ",e+="m-btn btn-sm m-btn--icon' download>",e+="<span><i class='flaticon-file'></i></a> "}},{title:"Opciones",data:null,orderable:!1,render:function(t){var e="";return e+="<button ",e+="class='btn btn-info ",e+="m-btn btn-sm m-btn--icon btn-edit' ",e+=" data-id='"+t.id+"'>",e+="<span><i class='la la-edit'></i><span>Editar</span></span></button> ",e+="<button ",e+="class='btn btn-danger btn-delete ",e+="m-btn btn-sm  m-btn--icon-only' ",e+=" data-id='"+t.id+"'>",e+="<i class='la la-trash'></i></button> "}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#data-table").DataTable(this.options),this.events()},events:function(){$("#data-table").on("click",".btn-edit",(function(){var t=$(this).data("id");n.edit.show(t)})),$("#data-table").on("click",".btn-delete",(function(){var t=$(this).data("id");n.delete(t)}))}},annexes:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:`/unidad-emprendimiento/convocatorias-emprendimiento/${t}/archivos`.proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){delete t.columns,t.handler="DatatableAnnex",t.searchValue=$("#search").val()}},pageLength:50,orderable:[],columns:[{title:"Nombre",data:"name"},{title:"Código",data:"code"},{title:"Opciones",data:null,orderable:!1,render:function(t){var e="";return e+="<button ",e+="class='btn btn-info ",e+="m-btn btn-sm m-btn--icon btn-edit' ",e+=" data-id='"+t.id+"'>",e+="<span><i class='la la-edit'></i><span>Editar</span></span></button> ",e+="<button ",e+="class='btn btn-danger btn-delete ",e+="m-btn btn-sm  m-btn--icon-only' ",e+=" data-id='"+t.id+"'>",e+="<i class='la la-trash'></i></button> "}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#data-table-annex").DataTable(this.options),this.events()},events:function(){$("#data-table-annex").on("click",".btn-edit",(function(){var t=$(this).data("id");n.editAnnex.show(t)})),$("#data-table-annex").on("click",".btn-delete",(function(){var t=$(this).data("id");n.deleteAnnex(t)}))}},external_evaluator:{object:null,options:{ajax:{url:`/unidad-emprendimiento/convocatorias-emprendimiento/${t}/archivos`,type:"GET",data:function(t){delete t.columns,t.handler="ExternalEvaluatorDatatable"}},columns:[{data:"userName",title:"Usuario"},{data:"fullName",title:"Nombre Completo"},{data:"dni",title:"DNI"},{data:"email",title:"Correo Electrónico"},{data:null,title:"Opciones",render:function(t){var e="";return e+=`<button title='Eliminar' data-userid='${t.userId}' type='button' class="btn-delete btn btn-danger m-btn m-btn--icon btn-sm m-btn--icon-only"><i class="la la-trash"></i></button>`}}]},reload:function(){this.object.ajax.reload()},events:function(){$("#external_evaluator_datatable").on("click",".btn-delete",(function(){var n=$(this).data("userid"),a=new FormData;a.append("IncubatorConvocationId",t),a.append("UserId",n),swal({type:"warning",title:"Eliminará al evaluador seleccionado.",text:"¿Seguro que desea eliminarlo?.",confirmButtonText:"Sí",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({type:"POST",data:a,contentType:!1,processData:!1,url:`/unidad-emprendimiento/convocatorias-emprendimiento/${t}/archivos?handler=DeleteExternalEvaluator`,beforeSend:function(t){t.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())}}).done((function(){e.external_evaluator.reload(),swal({type:"success",title:"Completado",text:"Evaluador eliminado satisfactoriamente.",confirmButtonText:"Aceptar"})})).fail((function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===t.status?"No hay respuesta del servidor":t.responseText})}))}))})}))},init:function(){this.object=$("#external_evaluator_datatable").DataTable(this.options),this.events()}},init:function(){this.files.init(),this.annexes.init(),this.external_evaluator.init()}},n={create:{object:$("#add-form").validate({submitHandler:function(t,a){$("#btnSave").addLoader(),a.preventDefault();let o=new FormData(t);$.ajax({url:$(t).attr("action"),type:"POST",data:o,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.files.reload(),n.create.clear()})).fail((function(t){toastr.error(t.responseText,_app.constants.toastr.title.error),$("#btnSave").removeLoader()})).always((function(){}))}}),show:function(){$("#btnSave").removeLoader(),$("#addModal").modal("toggle")},clear:function(){$("#add-form").find(".custom-file-label").text("Seleccionar archivo"),n.create.object.resetForm()},events:function(){$("#addModal").on("hidden.bs.modal",(function(){n.create.clear()}))}},edit:{object:$("#edit-form").validate({submitHandler:function(t,a){$("#btnEdit").addLoader(),a.preventDefault();let o=new FormData(t);$.ajax({url:$(t).attr("action"),type:"POST",data:o,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.files.reload(),n.edit.clear()})).fail((function(t){toastr.error(t.responseText,_app.constants.toastr.title.error),$("#btnEdit").removeLoader()})).always((function(){}))}}),load:function(e){$.ajax({url:`/unidad-emprendimiento/convocatorias-emprendimiento/${t}/archivos`.proto().parseURL(),type:"GET",data:{handler:"DetailFile",incubatorConvocationFileId:e}}).done((function(t){$("#edit-form input[name=Number]").val(t.number),$("#edit-form input[name=Name]").val(t.name),$("#edit-form input[name=IncubatorConvocationFileId]").val(t.id),$("#edit-form").find(".custom-file-label").text("Seleccionar archivo"),$("#edit-form").find(".custom-file").append('<div class="form-control-feedback">*Seleccionar en caso sea necesario reemplazar el documento vigente.</div>')})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!==t.responseText&&""!==t.responseText?$("#add_form_msg_txt").html(t.responseText):$("#add_form_msg_txt").html(_app.constants.ajax.message.error),$("#add_form_msg").removeClass("m--hide").show()})).always((function(){}))},show:function(t){$("#btnEdit").removeLoader(),n.edit.load(t),$("#editModal").modal("toggle")},clear:function(){$("#edit-form").find(".custom-file-label").text("Seleccionar archivo"),n.edit.object.resetForm()},events:function(){$("#editModal").on("hidden.bs.modal",(function(){n.edit.clear()}))}},delete:function(n){swal({title:"¿Está seguro?",text:"El Archivo será eliminado.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((a=>{$.ajax({url:`/unidad-emprendimiento/convocatorias-emprendimiento/${t}/archivos?handler=DeleteIncubatorConvocationFile`.proto().parseURL(),type:"POST",data:{id:n},beforeSend:function(t){t.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},success:function(t){swal({type:"success",title:"Completado",text:"El Archivo ha sido eliminado con exito",confirmButtonText:"Excelente"}).then(e.files.reload())},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"El Archivo presenta información relacionada"})}})})),allowOutsideClick:()=>!swal.isLoading()})},createAnnex:{object:$("#add-form-annex").validate({submitHandler:function(t,a){$("#btnSave").addLoader(),a.preventDefault();let o=new FormData(t);$.ajax({url:$(t).attr("action"),type:"POST",data:o,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.annexes.reload(),n.create.clear()})).fail((function(t){toastr.error(t.responseText,_app.constants.toastr.title.error),$("#btnSave").removeLoader()})).always((function(){}))}}),show:function(){$("#btnSave").removeLoader(),$("#addModalAnnex").modal("toggle")},clear:function(){n.createAnnex.object.resetForm()},events:function(){$("#addModalAnnex").on("hidden.bs.modal",(function(){n.createAnnex.clear()}))}},editAnnex:{object:$("#edit-form-annex").validate({submitHandler:function(t,a){$("#btnEdit").addLoader(),a.preventDefault();let o=new FormData(t);$.ajax({url:$(t).attr("action"),type:"POST",data:o,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.annexes.reload(),n.edit.clear()})).fail((function(t){toastr.error(t.responseText,_app.constants.toastr.title.error),$("#btnEdit").removeLoader()})).always((function(){}))}}),load:function(e){$.ajax({url:`/unidad-emprendimiento/convocatorias-emprendimiento/${t}/archivos`.proto().parseURL(),type:"GET",data:{handler:"DetailAnnex",incubatorConvocationAnnexId:e}}).done((function(t){$("#edit-form-annex input[name=Code]").val(t.code),$("#edit-form-annex input[name=Name]").val(t.name),$("#edit-form-annex input[name=IncubatorConvocationAnnexId]").val(t.id)})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!==t.responseText&&""!==t.responseText?$("#add_form_msg_txt").html(t.responseText):$("#add_form_msg_txt").html(_app.constants.ajax.message.error),$("#add_form_msg").removeClass("m--hide").show()})).always((function(){}))},show:function(t){$("#btnEdit").removeLoader(),n.editAnnex.load(t),$("#editModalAnnex").modal("toggle")},clear:function(){n.editAnnex.object.resetForm()},events:function(){$("#editModalAnnex").on("hidden.bs.modal",(function(){n.editAnnex.clear()}))}},deleteAnnex:function(n){swal({title:"¿Está seguro?",text:"El Anexo será eliminado.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((a=>{$.ajax({url:`/unidad-emprendimiento/convocatorias-emprendimiento/${t}/archivos?handler=DeleteIncubatorConvocationAnnex`.proto().parseURL(),type:"POST",data:{id:n},beforeSend:function(t){t.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},success:function(t){swal({type:"success",title:"Completado",text:"El Anexo ha sido eliminado con exito",confirmButtonText:"Excelente"}).then(e.annexes.reload())},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"El Anexo presenta información relacionada"})}})})),allowOutsideClick:()=>!swal.isLoading()})},external_evaluator:{object:$("#external_evaluator_form"),form:{object:$("#external_evaluator_form").validate({submitHandler:function(a,o){o.preventDefault(),mApp.block(n.external_evaluator.object,{message:"Agregando evaluador..."}),$.ajax({url:`/unidad-emprendimiento/convocatorias-emprendimiento/${t}/archivos?handler=AddExternalEvaluator`,method:"POST",data:$(a).serialize()}).done((function(t){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.external_evaluator.reload()})).fail((function(t){var e=502===t.status?"No hay respuesta del servidor":t.responseText;toastr.error(e,_app.constants.toastr.title.error)})).always((function(){n.external_evaluator.object.find(":input").attr("disabled",!1),mApp.unblock(n.external_evaluator.object)}))}})}},init:function(){this.create.events(),this.edit.events(),this.createAnnex.events(),this.editAnnex.events()}},a=function(){$("#search").doneTyping((function(){e.files.reload()}))},o=function(){$("#AddBtn").on("click",(function(){n.create.show()})),$("#AddBtnAnnex").on("click",(function(){n.createAnnex.show()}))},i={init:function(){this.external_evaluator.init()},external_evaluator:{init:function(){this.load()},load:function(){n.external_evaluator.object.find("[name='UserId']").select2({ajax:{url:"/api/usuarios/select/evaluadores-externos",delay:300},minimumInputLength:2,dropdownParent:n.external_evaluator.object,placeholder:"Seleccione evaluador externo...",allowClear:!0})}}};return{init:function(){e.init(),n.init(),a(),o(),i.init()}}}();$((function(){InitApp.init()}));