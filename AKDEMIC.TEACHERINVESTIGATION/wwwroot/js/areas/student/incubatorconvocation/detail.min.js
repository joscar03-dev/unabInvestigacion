var InitApp=function(){var e=$("#create-form input[name='IncubatorConvocationId']").val(),t=[],a=[],n=function(){$.ajax({url:`/alumno/convocatoria-emprendimiento/${e}/detalle?handler=IncubatorConvocationAnnex`.proto().parseURL(),type:"GET"}).done((function(e){for(var t=0;t<e.length;t++)a.push({incubatorConvocationAnnexId:e[t].id,code:e[t].code,name:e[t].name,file:null,size:"0"});o.document.reload()}))},o={teamMember:{object:null,options:{serverSide:!1,filter:!1,lengthChange:!1,data:t,columns:[{title:"Cod Alumno",data:"userName"},{title:"Apellido Paterno",data:"paternalSurname"},{title:"Apellido Materno",data:"maternalSurname"},{title:"Nombres",data:"name"},{title:"Escuela Profesional",data:"career"},{title:"Opciones",render:function(e,t){return`<button data-index="${t}" type="button" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete-teamMember"<span><i class="la la-trash"> </i> </span> Eliminar </span></span></button>`}}]},reload:function(){this.object.clear(),this.object.rows.add(t),this.object.draw()},events:function(){$("#teammember-table").on("click",".btn-delete-teamMember",(function(){let e=$(this).data("index");t.splice(e,1),o.teamMember.reload()}))},init:function(){this.object=$("#teammember-table").DataTable(this.options),this.events()}},document:{object:null,options:{serverSide:!1,filter:!1,lengthChange:!1,data:a,columns:[{title:"Código",data:"code"},{title:"Nombre",data:"name"},{title:"Tamaño",data:null,render:function(e){return function(e){if(0==e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t]}(e.size)}},{title:"Opciones",data:null,orderable:!1,render:function(e){var t="";return t+="<button type='button' ",t+="class='btn btn-success btn-upload-document ",t+="m-btn btn-sm  m-btn--icon-only' ",t+=` data-name='${e.name}' data-id='${e.incubatorConvocationAnnexId}' >`,t+="<i class='la la-file'></i></button> "}}]},reload:function(){this.object.clear(),this.object.rows.add(a),this.object.draw()},events:function(){$("#document-table").on("click",".btn-upload-document",(function(){var e=$(this).data("name"),t=$(this).data("id");$("#add-document-form input[name='Name']").val(e),$("#add-document-form input[name='Id']").val(t),i.document.show()}))},init:function(){this.object=$("#document-table").DataTable(this.options),this.events()}},init:function(){this.teamMember.init(),this.document.init()}},r={init:function(){this.department.init(),this.province.init(),this.district.init(),this.teamMember.init(),this.adviser.init(),this.coAdviser.init()},department:{init:function(){this.load(),this.events()},load:function(){$.ajax({url:"/api/departamentos/get".proto().parseURL(),type:"GET"}).done((function(e){$("#DepartmentId").select2({data:e})}))},events:function(){$("#DepartmentId").on("change",(function(){0==$(this).val()?(r.province.clear(),r.district.clear()):r.province.load()}))}},province:{init:function(){$("#ProvinceId").select2(),this.events()},clear:function(){$("#ProvinceId").empty(),$("#ProvinceId").html('<option value="0" selected disabled>Selecciona Provincia</option>')},load:function(){r.province.clear(),r.district.clear(),$.ajax({url:"/api/provincias/get".proto().parseURL(),type:"GET",data:{departmentId:$("#DepartmentId").val()}}).done((function(e){$("#ProvinceId").select2({data:e})}))},events:function(){$("#ProvinceId").on("change",(function(){0==$(this).val()?r.district.clear():r.district.load()}))}},district:{init:function(){$("#DistrictId").select2()},clear:function(){$("#DistrictId").empty(),$("#DistrictId").html('<option value="0" selected disabled>Selecciona Distrito</option>')},load:function(){r.district.clear(),$.ajax({url:"/api/distritos/get".proto().parseURL(),type:"GET",data:{provinceId:$("#ProvinceId").val()}}).done((function(e){$("#DistrictId").select2({data:e})}))}},teamMember:{init:function(){$("#add-teammember-form select[name=UserId]").select2({width:"100%",dropdownParent:$("#add-teammember-modal"),placeholder:"Buscar...",ajax:{url:"/api/estudiantes/select-search".proto().parseURL(),dataType:"json",data:function(e){return{term:e.term,page:e.page}},processResults:function(e,t){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3}),$("#add-teammember-form select[name=UserId]").on("change",(function(){let e=$(this).select2("data")[0].userName,t=$(this).select2("data")[0].paternalSurname,a=$(this).select2("data")[0].maternalSurname,n=$(this).select2("data")[0].name,o=$(this).select2("data")[0].career,r=$(this).select2("data")[0].sex;$("#add-teammember-form input[name='UserName']").val(e),$("#add-teammember-form input[name='PaternalSurname']").val(t),$("#add-teammember-form input[name='MaternalSurname']").val(a),$("#add-teammember-form input[name='Name']").val(n),$("#add-teammember-form input[name='Sex']").val(r),$("#add-teammember-form input[name='Career']").val(o)}))}},adviser:{init:function(){$("#create-form select[name=AdviserId]").select2({width:"100%",placeholder:"Buscar...",ajax:{url:"/api/docentes/select-search".proto().parseURL(),dataType:"json",data:function(e){return{term:e.term,page:e.page}},processResults:function(e,t){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3})}},coAdviser:{init:function(){$("#create-form select[name=CoAdviserId]").select2({width:"100%",placeholder:"Buscar...",ajax:{url:"/api/docentes/select-search".proto().parseURL(),dataType:"json",data:function(e){return{term:e.term,page:e.page}},processResults:function(e,t){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3})}}},i={teamMember:{object:$("#add-teammember-form").validate({submitHandler:function(e,a){$("#btnSaveTeamMember").addLoader(),a.preventDefault();let n=$("#add-teammember-form select[name=UserId]").select2("data")[0].userName,r=$("#add-teammember-form select[name=UserId]").select2("data")[0].paternalSurname,i=$("#add-teammember-form select[name=UserId]").select2("data")[0].maternalSurname,d=$("#add-teammember-form select[name=UserId]").select2("data")[0].name,c=$("#add-teammember-form select[name=UserId]").select2("data")[0].career,m=$("#add-teammember-form select[name=UserId]").select2("data")[0].sex;t.push({userName:n,paternalSurname:r,maternalSurname:i,name:d,career:c,sex:m}),o.teamMember.reload(),$("#btnSaveTeamMember").removeLoader(),$("#add-teammember-modal").modal("hide")}}),show:function(){$("#btnSaveTeamMember").removeLoader(),$("#add-teammember-modal").modal("toggle")},clear:function(){i.teamMember.object.resetForm()},events:function(){$("#add-teammember-modal").on("hidden.bs.modal",(function(){i.teamMember.clear()}))},init:function(){this.events()}},document:{object:$("#add-document-form").validate({submitHandler:function(e,t){$("#btnSaveDocument").addLoader(),t.preventDefault();let n=$("#add-document-form input[name='Id']").val(),r=$("#add-document-form input[name='File']")[0].files[0],i=a.findIndex((e=>e.incubatorConvocationAnnexId==n));a[i].file=r,a[i].size=r.size,o.document.reload(),$("#btnSaveDocument").removeLoader(),$("#add-document-modal").modal("hide")}}),show:function(){$("#btnSaveDocument").removeLoader(),$("#add-document-modal").modal("toggle")},clear:function(){$("#add-file-form input[name='File']").next().html("Seleccione archivo"),i.document.object.resetForm()},events:function(){$("#add-document-modal").on("hidden.bs.modal",(function(){i.document.clear()}))},init:function(){this.events()}},init:function(){this.author.init(),this.document.init()}},d={incubatorPostulation:{init:function(){$("#create-form").validate({submitHandler:function(e,n){if(a.filter((e=>null==e.file)).length>0)return void toastr.error("Todos los documentos de anexo son necesarios",_app.constants.toastr.title.error);$("#btnSave").addLoader(),n.preventDefault();let o=new FormData(e);for(var r=0;r<t.length;r++)o.append(`IncubatorPostulationTeamMembers[${r}].PaternalSurname`,t[r].paternalSurname),o.append(`IncubatorPostulationTeamMembers[${r}].MaternalSurname`,t[r].maternalSurname),o.append(`IncubatorPostulationTeamMembers[${r}].Name`,t[r].name),o.append(`IncubatorPostulationTeamMembers[${r}].UserName`,t[r].userName),o.append(`IncubatorPostulationTeamMembers[${r}].Sex`,t[r].sex),o.append(`IncubatorPostulationTeamMembers[${r}].Career`,t[r].career);for(r=0;r<a.length;r++)o.append(`IncubatorPostulationAnnexes[${r}].AnnexFile`,a[r].file),o.append(`IncubatorPostulationAnnexes[${r}].IncubatorConvocationAnnexId`,a[r].incubatorConvocationAnnexId);o.append("DepartmentText",$("#DepartmentId option:selected").text()),o.append("ProvinceText",$("#ProvinceId option:selected").text()),o.append("DistrictText",$("#DistrictId option:selected").text()),$.ajax({url:$(e).attr("action"),type:"POST",data:o,contentType:!1,processData:!1}).done((function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),location.href="/alumno/convocatoria-emprendimiento".proto().parseURL()})).fail((function(e){toastr.error(e.responseText,_app.constants.toastr.title.error),$("#btnSave").removeLoader()})).always((function(){}))}})}},init:function(){this.incubatorPostulation.init()}};return{init:function(){o.init(),r.init(),n(),d.init()},print:function(){console.log(a)}}}();$((function(){InitApp.init()}));