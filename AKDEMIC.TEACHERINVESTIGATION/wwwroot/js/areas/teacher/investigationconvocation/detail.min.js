var InitApp=function(){var t=$("#InvestigationConvocationPostulantId").val(),e={init:function(){this.files.init(),this.inquiries.init()},files:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:`/investigador/convocatoria/${t}/detalle`.proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.handler="Datatable",t.searchValue=$("#search").val()}},pageLength:50,orderable:[],columns:[{title:"Número",data:"number"},{title:"Nombre",data:"name"},{title:"Archivo",data:null,orderable:!1,render:function(t){var e="";return e+=`<a href="${`/documentos/${t.filePath}`.proto().parseURL()}"  `,e+="class='btn btn-success ",e+="m-btn btn-sm m-btn--icon' download>",e+="<span><i class='flaticon-file'></i></a> "}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#data-table").DataTable(this.options)}},inquiries:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:`/investigador/convocatoria/${t}/detalle`.proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.handler="InquiriesDatatable",t.searchValue=$("#search").val()}},pageLength:50,orderable:[],columns:[{title:"Consulta",data:"inquiry"},{title:"Usuario",data:"userName"},{title:"Nombre Completo",data:"fullName"},{title:"Archivo",data:null,orderable:!1,render:function(t){var e="";null!=t.filePath&&(e+=`<a href="${`/documentos/${t.filePath}`.proto().parseURL()}"  `,e+="class='btn btn-success ",e+="m-btn btn-sm m-btn--icon' download>",e+="<span><i class='flaticon-file'></i></a> ");return e}},{title:"Opciones",data:null,orderable:!1,render:function(t){var e="";return e+="<button ",e+="class='btn btn-info ",e+="m-btn btn-sm m-btn--icon btn-edit' ",e+=" data-id='"+t.id+"'>",e+="<span><i class='la la-edit'></i><span>Editar</span></span></button> ",e+="<button ",e+="class='btn btn-danger btn-delete ",e+="m-btn btn-sm  m-btn--icon-only' ",e+=" data-id='"+t.id+"'>",e+="<i class='la la-trash'></i></button> "}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#data-table-inquiries").DataTable(this.options),this.events()},events:function(){$("#data-table-inquiries").on("click",".btn-edit",(function(){var t=$(this).data("id");a.edit.show(t)})),$("#data-table-inquiries").on("click",".btn-delete",(function(){var t=$(this).data("id");a.delete(t)}))}}},a={create:{object:$("#add-form").validate({submitHandler:function(t,n){$("#btnSave").addLoader(),n.preventDefault();let o=new FormData(t);$.ajax({url:$(t).attr("action"),type:"POST",data:o,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.inquiries.reload(),a.create.clear()})).fail((function(t){toastr.error(t.responseText,_app.constants.toastr.title.error),$("#btnSave").removeLoader()})).always((function(){}))}}),show:function(){$("#btnSave").removeLoader(),$("#addModal").modal("toggle")},clear:function(){$("#add-form").find(".custom-file-label").text("Seleccionar archivo"),a.create.object.resetForm()},events:function(){$("#addModal").on("hidden.bs.modal",(function(){a.create.clear()}))}},edit:{object:$("#edit-form").validate({submitHandler:function(t,n){$("#btnEdit").addLoader(),n.preventDefault();let o=new FormData(t);$.ajax({url:$(t).attr("action"),type:"POST",data:o,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.inquiries.reload(),a.edit.clear()})).fail((function(t){toastr.error(t.responseText,_app.constants.toastr.title.error),$("#btnEdit").removeLoader()})).always((function(){}))}}),load:function(e){$.ajax({url:`/investigador/convocatoria/${t}/detalle`.proto().parseURL(),type:"GET",data:{handler:"DetailFileInquiry",investigationConvocationFileInquiryId:e}}).done((function(t){$("#edit-form textarea[name=Inquiry]").val(t.inquiry),$("#edit-form input[name=InvestigationConvocationFileInquiryId]").val(t.id),$("#edit-form").find(".custom-file-label").text("Seleccionar archivo"),$("#edit-form").find(".custom-file").append('<div class="form-control-feedback">*Seleccionar en caso sea necesario reemplazar el documento vigente.</div>')})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!==t.responseText&&""!==t.responseText?$("#add_form_msg_txt").html(t.responseText):$("#add_form_msg_txt").html(_app.constants.ajax.message.error),$("#add_form_msg").removeClass("m--hide").show()})).always((function(){}))},show:function(t){$("#btnEdit").removeLoader(),a.edit.load(t),$("#editModal").modal("toggle")},clear:function(){$("#edit-form").find(".custom-file-label").text("Seleccionar archivo"),a.edit.object.resetForm()},events:function(){$("#editModal").on("hidden.bs.modal",(function(){a.edit.clear()}))}},delete:function(a){swal({title:"¿Está seguro?",text:"La Consulta será eliminada.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((n=>{$.ajax({url:`/investigador/convocatoria/${t}/detalle`.proto().parseURL(),type:"GET",data:{handler:"InquiryDelete",id:a},success:function(t){swal({type:"success",title:"Completado",text:"La Consulta ha sido eliminada con exito",confirmButtonText:"Excelente"}).then(e.inquiries.reload())},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"La Consulta presenta información relacionada"})}})})),allowOutsideClick:()=>!swal.isLoading()})},init:function(){this.create.events(),this.edit.events()}},n=function(){$("#search").doneTyping((function(){e.files.reload()}))},o={init:function(){this.investigationConvocationDate.init()},investigationConvocationDate:{init:function(){$("#InvestigationConvocationStartDate").datepicker({clearBtn:!0,orientation:"bottom",format:_app.constants.formats.datepicker}),$("#InvestigationConvocationEndDate").datepicker({clearBtn:!0,orientation:"bottom",format:_app.constants.formats.datepicker})}}},i={init:function(){this.allowInquiries.init()},allowInquiries:{init:function(){$("#InvestigationConvocationAllowInquiries").bootstrapSwitch({onText:"SÍ",offText:"NO",onColor:"success",offColor:"danger"})}}},r=function(){$("#AddBtn").on("click",(function(){a.create.show()}))};return{init:function(){e.init(),a.init(),n(),o.init(),i.init(),r()}}}();$((function(){InitApp.init()}));