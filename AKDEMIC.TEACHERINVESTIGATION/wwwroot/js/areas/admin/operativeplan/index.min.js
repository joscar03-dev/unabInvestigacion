var InitApp=function(){var t={operativeplan:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:"/admin/plan-operativo".proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.handler="Datatable",t.searchValue=$("#search").val()}},pageLength:50,orderable:[],columns:[{title:"Nombre",data:"name"},{title:"Año",data:"year"},{title:"Estado",data:null,render:function(t){switch(t.state){case 0:return`<span class="m--font-warning">${t.stateText}</span>`;case 1:return`<span class="m--font-info">${t.stateText}</span>`;case 2:return`<span class="m--font-danger">${t.stateText}</span>`}}},{title:"Archivo",data:null,orderable:!1,render:function(t){var e="";return e+=`<a href="${`/documentos/${t.filePath}`.proto().parseURL()}"  `,e+="class='btn btn-success ",e+="m-btn btn-sm m-btn--icon' download>",e+="<span><i class='flaticon-file'></i></a> "}},{title:"Unidad",data:"unitText"},{title:"Jefe de Unidad",data:"unitBoss"},{title:"Opciones",data:null,orderable:!1,render:function(t){var e="";return 1!=t.state&&(e+="<button ",e+="class='btn btn-info ",e+="m-btn btn-sm m-btn--icon btn-edit' ",e+=" data-id='"+t.id+"'>",e+="<span><i class='la la-edit'></i><span>Observar</span></span></button> ",e+="<button type='button' ",e+="class='btn btn-success btn-delete ",e+="m-btn btn-sm  m-btn--icon-only' ",e+=" data-id='"+t.id+"'>",e+="<i class='la la-check'></i></button> "),e}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#data-table").DataTable(this.options),this.events()},events:function(){$("#data-table").on("click",".btn-edit",(function(){var t=$(this).data("id");a.operativeplan.edit.show(t)})),$("#data-table").on("click",".btn-delete",(function(){let e=$(this).data("id");swal({title:"¿Está seguro?",text:"El Plan Operativo sera aprovado",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, aprovarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((a=>{$.ajax({url:"/admin/plan-operativo?handler=Approve".proto().parseURL(),type:"POST",data:{id:e},beforeSend:function(t){t.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},success:function(e){swal({type:"success",title:"Completado",text:"El Plan Operativo ha sido aprovado con exito",confirmButtonText:"Excelente"}).then(t.operativeplan.reload())},error:function(e){let a="El Plan operativo presenta errores";null!=e&&(a=e.responseText),swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:a}).then(t.operativeplan.reload())}})})),allowOutsideClick:()=>!swal.isLoading()})}))}},init:function(){this.operativeplan.init()}},e=function(){$("#search").doneTyping((function(){t.operativeplan.reload()}))},a={operativeplan:{edit:{object:$("#edit-form").validate({submitHandler:function(e,n){$("#btnEdit").addLoader(),n.preventDefault();let o=new FormData(e);$.ajax({url:$(e).attr("action"),type:"POST",data:o,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),t.operativeplan.reload(),a.operativeplan.edit.clear(),$("#btnEdit").removeLoader()})).fail((function(t){toastr.error(t.responseText,_app.constants.toastr.title.error),$("#btnEdit").removeLoader()})).always((function(){}))}}),load:function(t){$.ajax({url:"/admin/plan-operativo".proto().parseURL(),type:"GET",data:{handler:"DetailOperativePlan",Id:t}}).done((function(t){$("#edit-form input[name=Id]").val(t.id),$("#edit-form input[name=Observation]").val(t.observation),$("#btnEdit").removeLoader()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),$("#btnEdit").removeLoader()})).always((function(){}))},show:function(t){$("#btnEdit").removeLoader(),a.operativeplan.edit.load(t),$("#editModal").modal("toggle")},clear:function(){a.operativeplan.edit.object.resetForm()},events:function(){$("#editModal").on("hidden.bs.modal",(function(){a.operativeplan.edit.clear()}))}},init:function(){this.edit.events()}},init:function(){this.operativeplan.init()}};return{init:function(){t.init(),e(),a.init()}}}();$((function(){InitApp.init()}));