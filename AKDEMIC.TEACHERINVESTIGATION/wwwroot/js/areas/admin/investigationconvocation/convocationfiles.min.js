var InitApp=function(){var t=$("#InvestigationConvocationId").val(),e={files:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:`/admin/convocatoria-de-investigacion/${t}/archivos`.proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.handler="Datatable",t.searchValue=$("#search").val()}},pageLength:50,orderable:[],columns:[{title:"Número",data:"number"},{title:"Nombre",data:"name"},{title:"Archivo",data:null,orderable:!1,render:function(t){var e="";return e+=`<a href="${`/documentos/${t.filePath}`.proto().parseURL()}"  `,e+="class='btn btn-success ",e+="m-btn btn-sm m-btn--icon' download>",e+="<span><i class='flaticon-file'></i></a> "}},{title:"Opciones",data:null,orderable:!1,render:function(t){var e="";return e+="<button ",e+="class='btn btn-info ",e+="m-btn btn-sm m-btn--icon btn-edit' ",e+=" data-id='"+t.id+"'>",e+="<span><i class='la la-edit'></i><span>Editar</span></span></button> ",e+="<button ",e+="class='btn btn-danger btn-delete ",e+="m-btn btn-sm  m-btn--icon-only' ",e+=" data-id='"+t.id+"'>",e+="<i class='la la-trash'></i></button> "}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#data-table").DataTable(this.options),this.events()},events:function(){$("#data-table").on("click",".btn-edit",(function(){var t=$(this).data("id");a.edit.show(t)})),$("#data-table").on("click",".btn-delete",(function(){var t=$(this).data("id");a.delete(t)}))}},inquiries:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:`/admin/convocatoria-de-investigacion/${t}/archivos`.proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.handler="InquiriesDatatable",t.searchValue=$("#search").val()}},pageLength:50,orderable:[],columns:[{title:"Consulta",data:"inquiry"},{title:"Usuario",data:"userName"},{title:"Nombre Completo",data:"fullName"},{title:"Archivo",data:null,orderable:!1,render:function(t){var e="";null!=t.filePath&&(e+=`<a href="${`/documentos/${t.filePath}`.proto().parseURL()}"  `,e+="class='btn btn-success ",e+="m-btn btn-sm m-btn--icon' download>",e+="<span><i class='flaticon-file'></i></a> ");return e}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#data-table-inquiries").DataTable(this.options)}},external_evaluator:{object:null,options:{ajax:{url:`/admin/convocatoria-de-investigacion/${t}/archivos`,type:"GET",data:function(t){t.handler="ExternalEvaluatorDatatable"}},columns:[{data:"userName",title:"Usuario"},{data:"fullName",title:"Nombre Completo"},{data:"dni",title:"DNI"},{data:"email",title:"Correo Electrónico"},{data:null,title:"Opciones",render:function(t){var e="";return e+=`<button title='Eliminar' data-userid='${t.userId}' type='button' class="btn-delete btn btn-danger m-btn m-btn--icon btn-sm m-btn--icon-only"><i class="la la-trash"></i></button>`}}]},reload:function(){e.external_evaluator.object.ajax.reload()},events:{onDelete:function(){$("#external_evaluator_datatable").on("click",".btn-delete",(function(){var a=$(this).data("userid"),n=new FormData;n.append("InvestigationConvocationId",t),n.append("UserId",a),swal({type:"warning",title:"Eliminará al evaluador seleccionado.",text:"¿Seguro que desea eliminarlo?.",confirmButtonText:"Sí",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({type:"POST",data:n,contentType:!1,processData:!1,url:`/admin/convocatoria-de-investigacion/${t}/archivos?handler=DeleteExternalEvaluator`,beforeSend:function(t){t.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())}}).done((function(){e.external_evaluator.reload(),swal({type:"success",title:"Completado",text:"Evaluador eliminado satisfactoriamente.",confirmButtonText:"Aceptar"})})).fail((function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===t.status?"No hay respuesta del servidor":t.responseText})}))}))})}))},init:function(){this.onDelete()}},init:function(){e.external_evaluator.object=$("#external_evaluator_datatable").DataTable(e.external_evaluator.options),e.external_evaluator.events.init()}},init:function(){this.files.init(),this.external_evaluator.init(),this.inquiries.init()}},a={create:{object:$("#add-form").validate({submitHandler:function(t,n){$("#btnSave").addLoader(),n.preventDefault();let o=new FormData(t);$.ajax({url:$(t).attr("action"),type:"POST",data:o,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.files.reload(),a.create.clear()})).fail((function(t){toastr.error(t.responseText,_app.constants.toastr.title.error),$("#btnSave").removeLoader()})).always((function(){}))}}),show:function(){$("#btnSave").removeLoader(),$("#addModal").modal("toggle")},clear:function(){$("#add-form").find(".custom-file-label").text("Seleccionar archivo"),a.create.object.resetForm()},events:function(){$("#addModal").on("hidden.bs.modal",(function(){a.create.clear()}))}},edit:{object:$("#edit-form").validate({submitHandler:function(t,n){$("#btnEdit").addLoader(),n.preventDefault();let o=new FormData(t);$.ajax({url:$(t).attr("action"),type:"POST",data:o,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.files.reload(),a.edit.clear()})).fail((function(t){toastr.error(t.responseText,_app.constants.toastr.title.error),$("#btnEdit").removeLoader()})).always((function(){}))}}),load:function(e){$.ajax({url:`/admin/convocatoria-de-investigacion/${t}/archivos`.proto().parseURL(),type:"GET",data:{handler:"DetailFile",investigationConvocationFileId:e}}).done((function(t){$("#edit-form input[name=Number]").val(t.number),$("#edit-form input[name=Name]").val(t.name),$("#edit-form input[name=InvestigationConvocationFileId]").val(t.id),$("#edit-form").find(".custom-file-label").text("Seleccionar archivo"),$("#edit-form").find(".custom-file").append('<div class="form-control-feedback">*Seleccionar en caso sea necesario reemplazar el documento vigente.</div>')})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!==t.responseText&&""!==t.responseText?$("#add_form_msg_txt").html(t.responseText):$("#add_form_msg_txt").html(_app.constants.ajax.message.error),$("#add_form_msg").removeClass("m--hide").show()})).always((function(){}))},show:function(t){$("#btnEdit").removeLoader(),a.edit.load(t),$("#editModal").modal("toggle")},clear:function(){$("#edit-form").find(".custom-file-label").text("Seleccionar archivo"),a.edit.object.resetForm()},events:function(){$("#editModal").on("hidden.bs.modal",(function(){a.edit.clear()}))}},delete:function(t){swal({title:"¿Está seguro?",text:"El curso será eliminado.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((a=>{$.ajax({url:"/admin/cursos".proto().parseURL(),type:"GET",data:{handler:"CoursesDelete",id:t},success:function(t){swal({type:"success",title:"Completado",text:"El curso ha sido eliminado con exito",confirmButtonText:"Excelente"}).then(e.course.reload())},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"El curso presenta información relacionada"})}})})),allowOutsideClick:()=>!swal.isLoading()})},external_evaluator:{object:$("#external_evaluator_form"),form:{object:$("#external_evaluator_form").validate({submitHandler:function(n,o){o.preventDefault();var i=new FormData(n);i.append("InvestigationConvocationId",t),a.external_evaluator.object.find(":input").attr("disabled",!0),mApp.block(a.external_evaluator.object,{message:"Agregando evaluador..."}),$.ajax({url:`/admin/convocatoria-de-investigacion/${t}/archivos?handler=AddExternalEvaluator`,method:"post",data:i,contentType:!1,processData:!1}).done((function(t){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.external_evaluator.reload()})).fail((function(t){var e=502===t.status?"No hay respuesta del servidor":t.responseText;toastr.error(e,_app.constants.toastr.title.error)})).always((function(){a.external_evaluator.object.find(":input").attr("disabled",!1),mApp.unblock(a.external_evaluator.object)}))}})}},init:function(){this.create.events(),this.edit.events()}},n={external_evaluator:{load:function(){a.external_evaluator.object.find("[name='UserId']").select2({ajax:{url:"/api/usuarios/select/evaluadores-externos",delay:300},minimumInputLength:2,dropdownParent:a.external_evaluator.object,placeholder:"Seleccione evaluador externo...",allowClear:!0})},init:function(){this.load()}},init:function(){n.external_evaluator.init()}},o=function(){$("#search").doneTyping((function(){e.files.reload()}))},i={init:function(){this.allowInquiries.init()},allowInquiries:{init:function(){$("#InvestigationConvocationAllowInquiries").bootstrapSwitch({onText:"SÍ",offText:"NO",onColor:"success",offColor:"danger"})}}},r=function(){$("#AddBtn").on("click",(function(){a.create.show()}))};return{init:function(){e.init(),a.init(),o(),i.init(),r(),n.init()}}}();$((function(){InitApp.init()}));