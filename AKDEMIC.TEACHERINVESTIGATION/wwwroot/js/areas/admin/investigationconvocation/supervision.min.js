var InitApp=function(){var e=$("#InvestigationConvocationId").val(),t={supervisor:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:`/admin/convocatoria-de-investigacion/${e}/comite-tecnico`.proto().parseURL(),type:"GET",dataType:"JSON",data:function(e){e.handler="SupervisorDatatable",e.searchValue=$("#search").val()}},pageLength:50,orderable:[],columns:[{title:"Código de Usuario",data:"userName"},{title:"Nombre ",data:"name"},{title:"Apellido Paterno",data:"paternalSurname"},{title:"Apellido Materno",data:"maternalSurname"},{title:"DNI",data:"dni"},{title:"Opciones",data:null,orderable:!1,render:function(e){var t="";return t+="<button ",t+="class='btn btn-danger btn-delete ",t+="m-btn btn-sm  m-btn--icon-only' ",t+=" data-id='"+e.userId+"'>",t+="<i class='la la-trash'></i></button> "}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#data-table").DataTable(this.options),this.events()},events:function(){$("#data-table").on("click",".btn-delete",(function(){var e=$(this).data("id");a.delete(e)}))}},init:function(){this.supervisor.init()}},n=function(){$("#search").doneTyping((function(){t.supervisor.reload()}))},a={create:{object:$("#add-form").validate({submitHandler:function(e,n){$("#btnSave").addLoader(),n.preventDefault(),$.ajax({url:$(e).attr("action"),type:"POST",data:$(e).serialize()}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),t.supervisor.reload(),a.create.clear()})).fail((function(e){toastr.error(e.responseText,_app.constants.toastr.title.error),$("#btnSave").removeLoader()})).always((function(){}))}}),show:function(){$("#btnSave").removeLoader(),$("#addModal").modal("toggle")},clear:function(){$("#add-form select[name=UserId]").empty(),a.create.object.resetForm()},events:function(){$("#addModal").on("hidden.bs.modal",(function(){a.create.clear()}))}},delete:function(n){swal({title:"¿Está seguro?",text:"El miembro del comité técnico será eliminado.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((a=>{$.ajax({url:`/admin/convocatoria-de-investigacion/${e}/comite-tecnico`.proto().parseURL(),type:"GET",data:{handler:"SupervisorDelete",userId:n},success:function(e){swal({type:"success",title:"Completado",text:"El miembro del comité técnico ha sido eliminado con exito",confirmButtonText:"Excelente"}).then(t.supervisor.reload())},error:function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"El miembro del comité técnico presenta información relacionada"})}})})),allowOutsideClick:()=>!swal.isLoading()})},init:function(){this.create.events()}},o=function(){$("#AddBtn").on("click",(function(){a.create.show()}))},i={init:function(){this.supervisor.init(),this.userType.init()},userType:{init:function(){this.load(),this.events()},load:function(){$('#add-form select[name="UserType"]').select2({dropdownParent:$("#addModal")})},events:function(){$('#add-form select[name="UserType"]').on("change",(function(){$("#add-form select[name=UserId]").empty()}))}},supervisor:{init:function(){$("#add-form select[name=UserId]").select2({width:"100%",dropdownParent:$("#addModal"),placeholder:"Buscar...",ajax:{url:"/api/usuarios/select-search".proto().parseURL(),dataType:"json",data:function(e){return{userType:$('#add-form select[name="UserType"]').val(),term:e.term,page:e.page}},processResults:function(e,t){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3})}}};return{init:function(){i.init(),t.init(),a.init(),o(),n()}}}();$((function(){InitApp.init()}));