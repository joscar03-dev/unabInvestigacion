var InitApp=function(){var t=$("#Input_InvestigationConvocationPostulantId").val(),e=function(){$("#Accept").on("click",(function(){swal({title:"¿Está seguro?",text:"El estado de la postulación cambiará a Aceptado.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, cambiarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((e=>{$.ajax({url:`/admin/postulaciones/detalle/${t}?handler=Accept`.proto().parseURL(),type:"POST",beforeSend:function(t){t.setRequestHeader("XSRF-TOKEN",$('#observationModal input:hidden[name="__RequestVerificationToken"]').val())},success:function(t){swal({type:"success",title:"Completado",text:"El estado de la postulación ha sido cambiado con exito",confirmButtonText:"Excelente"})},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"No se ha podido cambiar el estado de la postulación"})}})})),allowOutsideClick:()=>!swal.isLoading()})})),$("#Reject").on("click",(function(){swal({title:"¿Está seguro?",text:"El estado de la postulación cambiará a Rechazado.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, cambiarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((e=>{$.ajax({url:`/admin/postulaciones/detalle/${t}?handler=Reject`.proto().parseURL(),type:"POST",beforeSend:function(t){t.setRequestHeader("XSRF-TOKEN",$('#observationModal input:hidden[name="__RequestVerificationToken"]').val())},success:function(t){swal({type:"success",title:"Completado",text:"El estado de la postulación ha sido cambiado con exito",confirmButtonText:"Excelente"})},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"No se ha podido cambiar el estado de la postulación"})}})})),allowOutsideClick:()=>!swal.isLoading()})}))},n={observation:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:`/admin/postulaciones/detalle/${t}`.proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.handler="ObservationsDatatable"}},pageLength:50,orderable:[],columns:[{title:"Fecha de Observación",data:"createdAt"},{title:"Descripción",data:"description"},{title:"Estado",data:null,render:function(t){switch(t.state){case 0:return`<span class="m--font-warning">${t.stateText}</span>`;case 1:return`<span class="m--font-info">${t.stateText}</span>`;case 2:return`<span class="m--font-danger">${t.stateText}</span>`;case 3:return`<span class="m--font-success">${t.stateText}</span>`;default:return`<span class="m--font-primary">${t.stateText}</span>`}}},{title:"Opciones",data:null,orderable:!1,render:function(t){var e="";return 1==t.state&&(e+="<button ",e+="class='btn btn-danger btn-rejected ",e+="m-btn btn-sm  m-btn--icon-only' ",e+=" data-id='"+t.id+"'>",e+="<i class='la la-close'></i></button> ",e+="<button ",e+="class='btn btn-success btn-solved ",e+="m-btn btn-sm  m-btn--icon-only' ",e+=" data-id='"+t.id+"'>",e+="<i class='la la-check'></i></button> "),e}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#observation-table").DataTable(this.options),this.events()},events:function(){$("#observation-table").on("click",".btn-rejected",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",text:"El estado de la observación cambiará a pendiente de correción.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, cambiarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((a=>{$.ajax({url:`/admin/postulaciones/detalle/${t}?handler=RejectObservation`.proto().parseURL(),type:"POST",data:{postulantObservationId:e},beforeSend:function(t){t.setRequestHeader("XSRF-TOKEN",$('#observationModal input:hidden[name="__RequestVerificationToken"]').val())},success:function(t){swal({type:"success",title:"Completado",text:"El estado de la observación ha sido cambiada con exito",confirmButtonText:"Excelente"}).then(n.observation.reload())},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"No se ha podido cambiar el estado de la observación"})}})})),allowOutsideClick:()=>!swal.isLoading()})})),$("#observation-table").on("click",".btn-solved",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",text:"El estado de cambiará a Subsanado.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, cambiarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((a=>{$.ajax({url:`/admin/postulaciones/detalle/${t}?handler=AbsolvedObservation`.proto().parseURL(),type:"POST",data:{postulantObservationId:e},beforeSend:function(t){t.setRequestHeader("XSRF-TOKEN",$('#observationModal input:hidden[name="__RequestVerificationToken"]').val())},success:function(t){swal({type:"success",title:"Completado",text:"El estado de la observación ha sido cambiada con exito",confirmButtonText:"Excelente"}).then(n.observation.reload())},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"No se ha podido cambiar el estado de la observación"})}})})),allowOutsideClick:()=>!swal.isLoading()})}))}},annexedFiles:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:`/admin/postulaciones/detalle/${t}`.proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.handler="AnnexedFileDatatable",t.searchValue=$("#search").val()}},pageLength:50,orderable:[],columns:[{title:"Nombre de Anexo",data:"name"},{title:"Fecha de Subida",data:"createdAt"},{title:"Archivo",data:null,orderable:!1,render:function(t){var e="";return e+=`<a href="${`/documentos/${t.documentPath}`.proto().parseURL()}"  `,e+="class='btn btn-success ",e+="m-btn btn-sm m-btn--icon' download>",e+="<span><i class='flaticon-file'></i></span></a> "}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#annexedFile-datatable").DataTable(this.options),this.events()},events:function(){$("#annexedFile-datatable").on("click",".btn-delete",(function(){var t=$(this).data("id");a.annexedFiles.delete(t)}))}},init:function(){this.observation.init(),this.annexedFiles.init()}},a={create:{object:$("#add-form").validate({submitHandler:function(t,e){$("#btnSave").addLoader(),e.preventDefault(),$.ajax({url:$(t).attr("action"),type:"POST",data:$(t).serialize()}).done((function(){$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),n.observation.reload(),$("#btnSave").removeLoader(),a.create.clear()})).fail((function(t){toastr.error(t.responseText,_app.constants.toastr.title.error),$("#btnSave").removeLoader()})).always((function(){}))}}),show:function(){$("#btnSave").removeLoader()},clear:function(){a.create.object.resetForm()},events:function(){$("#observationModal").on("hidden.bs.modal",(function(){a.create.clear()}))}},init:function(){this.create.events()}};return{init:function(){n.init(),a.init(),e()}}}();$((function(){InitApp.init()}));